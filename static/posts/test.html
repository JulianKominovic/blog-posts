<p>{{&lt; youtube id=&quot;eD1CUWs_3_k&quot; &gt;}}</p>
<p><strong>Firestore</strong> es la famosisíma <strong>base de datos NoSQL de Firebase</strong>. Tiene multitud de ventajas: lista para escalar muy fácilmente, una estructura basada en objetos similar a JSON, sincronización entre servidor y cliente...</p>
<p>Sin embargo, esta base de datos tiene un PERO muy grande y es que <strong>no tiene una forma fácil de realizar búsquedas de texto libre</strong> en sus documentos. Para ello tenías que recurrir a <a href="https://effbada.hashnode.dev/full-text-search-with-firebase-on-android-using-algolia-part-1-c86fc6e1c632">crear tu propia integración con servicios de terceros</a>. <strong>Hasta ahora.</strong></p>
<h2 id="algolia--firebase-la-extensión-perfecta-para-búsquedas">Algolia + Firebase. La extensión perfecta para búsquedas</h2>
<p><strong><a href="https://utm.io/udih1">Algolia</a></strong>, por si no lo conoces, es una plataforma que ofrece búsquedas muy rápidas y un sistema de recomendaciones. Ya se podía conectar en Firebase anteriormente pero se requería multitud de pasos para conseguir la conexión deseada.</p>
<p>Ahora, sin embargo, esto es mucho más sencillo con <a href="https://firebase.google.com/products/extensions/firestore-algolia-search">una extensión que será activar y listo. </a>Un click y ya tendremos la posibilidad de hacer búsquedas entre nuestros documentos de Firestore.</p>
<h2 id="¿cómo-funciona">¿Cómo funciona?</h2>
<p>Al activar la extensión, esta <strong>nos creará una Cloud Funciton</strong> que se ejecutará cada vez que se añada, elimine o modifique un documento en nuestra colección de Firestore.</p>
<p>{{&lt; img align=&quot;center&quot; src=&quot;<a href="https://blog-api.algolia.com/wp-content/uploads/2021/05/image1-3.png&quot;">https://blog-api.algolia.com/wp-content/uploads/2021/05/image1-3.png&quot;</a> alt=&quot;En este pequeño esquema podemos ver el funcionamiento de la extensión&quot; &gt;}}</p>
<p>Esta función <strong>se asegurará de sincronizar el índice de Algolia con la nueva información</strong>. Si añades un documento, lo añade al índice. Si lo borras, lo elimina del índice de Algolia. Y si modificas un documento, lo actualiza.</p>
<h2 id="¿cómo-puedo-activar-la-extensión">¿Cómo puedo activar la extensión?</h2>
<p>Antes de empezar, ten en cuenta que necesitarás lo siguiente:</p>
<ul>
<li>Una cuenta de <em>Algolia</em> (puede ser gratuita) con un índice creado.</li>
<li>Una cuenta y proyecto de <em>Firebase</em> (con el plan Braze activado)</li>
<li>Una cuenta en <em>Google Cloud Platform</em></li>
</ul>
<p>Ahora vamos al catálogo de extensiones de <strong>Firebase</strong> y le damos a <a href="https://firebase.google.com/products/extensions/firestore-algolia-search"><em>Search with Algolia</em></a>.</p>
<ol>
<li><code>Collection Path</code>. La colección de tu base de datos en Firestore.</li>
<li><code>Fields</code>. Los campos que quieres enviar al índice de Algolia.</li>
<li><code>Algolia Application ID</code>. La ID de tu aplicación en Algolia (la encuentras en tu sección de API Key).</li>
<li><code>Algolia Index Name</code>. El nombre del índice de <a href="https://utm.io/udih1">Algolia</a> que has debido crear previamente.</li>
<li><code>Algolia API Key</code>. La API Key. Lo recomendable es que crees una <em>API Key</em> especial para este caso. <strong>NO uses la API Key de Admin.</strong></li>
<li><code>Location</code>. La región donde quieres desplegar la <em>Cloud Function</em>. Lo ideal sería que fuese lo más cerca posible de la región que has seleccionado para tu índice.</li>
</ol>
<p>Una vez hecho esto... <strong>ten en cuenta que los documentos que ya tenías en la colección no serán enviados al índice de <a href="https://utm.io/udih1">Algolia</a>.</strong> En este caso tienes dos opciones:</p>
<ul>
<li>Ejecutar manualmente la <em>Cloud Function</em> para que envíe todos los documentos que ya están en la colección.</li>
<li>Modificar todos los documentos para que la <em>Cloud Function</em> se ejecute y los envié.</li>
</ul>
<p>Obviamente lo ideal sería tener la extensión activada antes de haber empezado a guardar documentos en la colección... Pero al menos tienes dos opciones en el caso que eso ya no sea posible. :)</p>
<p>También ten en cuenta que <strong>puedes activar la extensión para más de una colección diferente</strong>. Por ejemplo, podrías activarla para la colección <code>posts</code> y la colección <code>comments</code>. Tendrías que configurarla dos veces pero podrías reutilizar la <code>API Key</code>, por ejemplo, o incluso el índice si quisieras (aunque también puedes enviarlo a índices diferentes).</p>
<h2 id="¿qué-hay-del-precio-a-tener-en-cuenta">¿Qué hay del precio? A tener en cuenta...</h2>
<p>Aunque lo he mencionado anteriormente, es importante que tengas en cuenta que para poder utilizar esta extensión (y cualquier extensión de Firebase), tendrás que estar en el modo <code>Blaze</code> de Firebase. El modo <code>Blaze</code> es la modalidad de pago por uso.</p>
<p>Esta modalidad <strong>no quiere decir que tengas que pagar seguro</strong> (si no superas unos límites, Firebase ofrece una generosa cantidad de recursos sin coste) pero sí tendrás que configurar el pago por si fuese necesario.</p>
<p>También, <strong>cuando instales o reconfigures la extensión Firebase cobra unos 0.10$ como &quot;peaje&quot;</strong> ya que se deben ejecutar una serie de funciones en la nube.</p>
